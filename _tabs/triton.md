---
# the default layout is 'page'
title: Triton IR Parser
icon: fas fa-solid fa-microchip
order: 3
---

Triton IR Parser will parse the MLIR generated by triton compiler to display sections with instructions/operations and their corresponding file information.

<div>
    <div style="font-size: 8pt; font-family: monospace">
        <textarea id="input-box"
            style="width: 100%; height: 300px; background-color: #151515"></textarea>
    </div>
    <button id="parse-button" style="background-color: #151515">Parse</button>
    <div class="language-text highlighter-rouge">
        <div class="code-header">
            <span data-label-text="Parsed Output">
                <i class="fas fa-code fa-fw small"></i>
            </span>
            <button aria-label="copy" data-title-succeed="Copied!">
                <i class="far fa-clipboard">
                </i>
            </button>
        </div>
        <div id="output-div" style="white-space: pre; font-family: monospace" class="highlight">
        </div>
    </div>

    <script>
        function parseMlir(mlirCode) {
            // Split the MLIR code into lines
            const lines = mlirCode.split("\n");

            // Initialize an empty object to store the sections
            const sections = {};

            // Iterate over the lines
            for (const line of lines) {
                // Check if the line contains a location directive
                const match = line.match(/#loc(\d+) = loc\((.*)\)/);
                if (match) {
                    // Extract the location number and file information
                    const locNum = match[1];
                    const fileInfo = match[2].replace(/"/g, "");

                    // Initialize an empty array to store the code for this section
                    sections[locNum] = {
                        fileInfo,
                        code: [],
                    };
                }
            }

            for (const line of lines) {
                // Check if the line contains a MLIR instruction
                const match = line.match(/.*loc\(#loc(\d+)\)/);
                if (match) {
                    // Extract the location number
                    const locNum = match[1];

                    // Add the whole line to the corresponding section
                    if (locNum in sections) {
                        sections[locNum].code.push(line.trim());
                    }
                }
            }

            let output = "";
            let sectionNum = 1;
            for (const locNum in sections) {
                const section = sections[locNum];
                output += `<tr><td class="rouge-gutter gl"><pre class="lineno">${locNum}</pre></td><td class="rouge-code"><pre>Section ${sectionNum}: ${section.fileInfo}\n`;
                for (const line of section.code) {
                    output += `  ${line}\n`;
                }
                output += "</pre></td></tr>";
                sectionNum++;
            }

            return output;
        }

        const inputBox = document.getElementById('input-box');
        const outputDiv = document.getElementById('output-div');
        const parseButton = document.getElementById('parse-button');

        parseButton.addEventListener('click', () => {
            const mlirCode = inputBox.value;
            const parsedOutput = parseMlir(mlirCode);
            outputDiv.innerHTML = `<code><table class="rouge-table"><tbody>${parsedOutput}</tbody></table></code>`;
        });
    </script>
</div>
